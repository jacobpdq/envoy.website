!function(a){"use strict";var b={overlayDelay:300,hideDelay:300,cookieExpires:365,debug:!1,clickClose:!0,animationDuration:800,animationEasing:"linear",gaTracking:!1,shortkeys:!0,onOpen:function(a){return a},onClose:function(a){return a}},c=!1,d=!1,e=!1,f=!1,g=0,h=[],i=[],j=[],k=a("<div />").addClass("smartmodal-overlay").attr("id","smartmodal-overlay").css("display","none"),l={init:function(){b.gaTracking&&("undefined"!=typeof _gaq?(e=!0,f="c"):"undefined"!=typeof ga?(e=!0,f="u"):b.debug&&console.log("GA not loaded. Tracking disabled.")),window.localStorage?c=!0:b.debug&&console.log("Web storage not supported. Using jQuery.cookie plugin."),a.cookie?d=!0:b.debug&&console.log("jQuery.cookie plugin not loaded. Cookies have been disabled."),l.countModals(),l.setupModals(),l.eventHandler()},showModal:function(f){var g,j,m=a("#"+f),n=!1,o=b.animationEasing,p=b.animationDuration,q=!0,r=b.cookieExpires;return m.length?(m.addClass("smartmodal-modal"),l.positionModal(f),a("#smartmodal-overlay").length||a("body").append(k),m.data("animation")&&(m.data("animation").indexOf("|")>=0?(j=m.data("animation").split("|"),j[0]&&(g=j[0]),j[1]&&(o=j[1]),j[2]&&(p=parseInt(j[2],10))):g=m.data("animation"),n=!0,l.positionModal(f,g)),k.fadeIn(b.overlayDelay),n?m.show().animate({left:l.calculatePos(m,"left"),top:l.calculatePos(m,"top")},{duration:p,specialEasing:{top:o}}):m.fadeIn(b.overlayDelay),e&&m.data("name")&&l.gaTrackEvent("jQuery.smartModal",m.data("name"),"Opened"),b.onOpen&&(a.isFunction(b.onOpen)?b.onOpen(m.attr("id")):b.debug&&console.log(b.onOpen+" is not a valid function for onOpen.")),m.data("time")&&(m.data("close")&&"manual"===m.data("close")&&(q=!1,a(".close",m).hide()),q&&(h[f]=window.setTimeout(function(){var a=!1;m.hasClass("sticky")&&(m.removeClass("sticky"),a=!0),l.closeModal(f),a&&m.addClass("sticky")},1e3*m.data("time"))),a(".sec",m).length&&(a(".sec",m).text(m.data("time")),i[f]=window.setInterval(function(){var b=parseInt(a(".sec",m).text(),10)-1;b>=0?a(".sec",m).text(b):(!q&&a(".close",m).is(":hidden")&&(m.hasClass("sticky")&&m.data("time")&&m.removeClass("sticky").addClass("wasSticky"),a(".close",m).show()),window.clearInterval(i[f]))},1e3))),void(m.hasClass("once")&&(c?localStorage["smartModal-"+f]="shown":d&&(m.data("expires")&&(r=m.data("expires")),a.cookie("smartModal-"+f,"shown",{path:"/",expires:r}))))):(b.debug&&console.log("#"+f+" not found."),!1)},closeModal:function(c){if(a("#"+c).length){var d=a("#"+c);d.hasClass("sticky")||(d.hasClass("wasSticky")&&d.removeClass("wasSticky").addClass("sticky"),i[c]&&window.clearInterval(i[c]),h[c]&&window.clearTimeout(h[c]),d.fadeOut(b.hideDelay,function(){a(".smartmodal-modal:visible").length||l.removeOverlay()}),e&&d.data("name")&&l.gaTrackEvent("jQuery.smartModal",d.data("name"),"Closed"),b.onClose&&(a.isFunction(b.onClose)?b.onClose(d.attr("id")):b.debug&&console.log(b.onClose+" is not a valid function for onClose.")))}},removeOverlay:function(){a("#smartmodal-overlay").length&&a("#smartmodal-overlay").fadeOut(b.hideDelay,function(){a(this).remove()})},positionModal:function(b,c){if(b&&a("#"+b).length){var d=a("#"+b);if(c)switch(c){case"top":d.css({top:-d.height(),left:l.calculatePos(d,"left")});break;case"bottom":d.css({top:a(window).height()+d.height(),left:l.calculatePos(d,"left")});break;case"left":d.css({top:l.calculatePos(d,"top"),left:-d.width()});break;case"right":d.css({top:l.calculatePos(d,"top"),left:a(window).width()+d.width()})}else d.css({top:l.calculatePos(d,"top"),left:l.calculatePos(d,"left")})}},calculatePos:function(b,c){var d=a(window).width(),e=a(window).height(),f=b.width(),g=b.height();switch(c){case"left":return(d-f)/2;case"top":return(e-g)/2}},countModals:function(){g=a(".smartmodal").length,b.debug&&console.log(g+" modals found.")},eventHandler:function(){b.shortkeys&&a(document).keyup(function(b){27===b.keyCode&&a.each(a(".smartmodal-modal"),function(){if(!a(this).hasClass("sticky")){var b=a(this).attr("id");l.closeModal(b)}})}),a(".smartmodal .close").bind("click",function(){var b=a(this).closest(".smartmodal").attr("id");l.closeModal(b)}),a(window).resize(function(){a.each(a(".smartmodal"),function(){var b=a(this).attr("id");l.positionModal(b)})}),b.clickClose&&a("body").delegate("#smartmodal-overlay","click",function(b){b.preventDefault(),a.each(a(".smartmodal-modal"),function(){l.closeModal(a(this).attr("id"))})})},setupModals:function(){a(".smartmodal").each(function(){var e,f,h=a(this),i=!0;if(!h.attr("id"))for(;i;)f="SM-"+Math.floor(Math.random()*g+1),a("#"+f).length||(h.attr("id",f),i=!1);e=h.attr("id"),a.inArray(e,j)>-1&&b.debug&&console.log(" Multiple #"+e),j.push(e),h.hide(),h.hasClass("once")&&(c?"shown"===localStorage["smartModal-"+e]&&(h=!1,l.countModals()):d&&"shown"===a.cookie("smartModal-"+e)&&(h=!1,l.countModals())),h&&h.hasClass("auto")&&(h.data("wait")?setTimeout(function(){l.showModal(e)},1e3*h.data("wait")):l.showModal(e)),a("."+e).length&&a("."+e).bind("click",function(a){a.preventDefault(),l.showModal(e)})})},gaTrackEvent:function(a,b,c,d){e&&("c"===f?_gaq.push(["_trackEvent",a,b,c,d]):"u"===f&&ga("send","event",a,b,c,d))}};a.smartModal=function(c,d){if("object"==typeof c)b=a.extend(b,c),l.init();else if("string"==typeof c&&"string"==typeof d)switch(c){case"show":l.showModal(d);break;case"hide":l.closeModal(d);break;default:b.debug&&console.log(c+"not valid.")}else if("string"==typeof c&&"object"==typeof d)switch(c){case"init":d&&(b=a.extend(b,d)),l.init();break;case"settings":b=a.extend(b,d);break;default:b.debug&&console.log(c+" not valid.")}else l.init()}}(jQuery);